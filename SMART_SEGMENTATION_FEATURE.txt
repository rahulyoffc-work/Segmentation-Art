================================================================================
                    SMART SEGMENTATION FEATURE - IMPLEMENTATION GUIDE
================================================================================

Feature: Automatic Face vs Landscape Detection with Appropriate Model Selection
Implementation Date: October 28, 2025
Development Server: http://localhost:3000

================================================================================
                              OVERVIEW
================================================================================

The Extract Art demo now includes SMART SEGMENTATION that automatically:
1. Detects whether an uploaded image is a FACE/PORTRAIT or LANDSCAPE/OBJECT scene
2. Routes to the appropriate AI model:
   - FACE images ‚Üí Face Parsing Model (jonathandinu/face-parsing)
   - LANDSCAPE images ‚Üí Panoptic Segmentation Model (Mask2Former)
3. Provides visual feedback about which mode is active

================================================================================
                          HOW IT WORKS
================================================================================

WORKFLOW:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    USER UPLOADS IMAGE                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         USER CLICKS "DETECT REGIONS" BUTTON                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      STEP 1: IMAGE TYPE DETECTION (detectImageType function)        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Uses DETR Object Detection API                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Model: facebook/detr-resnet-50                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Logic:                                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Detects "person" objects in image                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Calculates person bounding box area                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ If person area > 25% of image ‚Üí FACE                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ If person area < 25% or no person ‚Üí LANDSCAPE            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                   ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   FACE MODE  ‚îÇ    ‚îÇ LANDSCAPE MODE‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                   ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ STEP 2A: Face Parsing    ‚îÇ  ‚îÇ STEP 2B: Panoptic     ‚îÇ
    ‚îÇ Model: face-parsing      ‚îÇ  ‚îÇ Model: Mask2Former    ‚îÇ
    ‚îÇ                          ‚îÇ  ‚îÇ                        ‚îÇ
    ‚îÇ Returns:                 ‚îÇ  ‚îÇ Returns:               ‚îÇ
    ‚îÇ ‚Ä¢ skin, nose             ‚îÇ  ‚îÇ ‚Ä¢ sky, trees           ‚îÇ
    ‚îÇ ‚Ä¢ l_eye, r_eye           ‚îÇ  ‚îÇ ‚Ä¢ buildings, roads     ‚îÇ
    ‚îÇ ‚Ä¢ l_brow, r_brow         ‚îÇ  ‚îÇ ‚Ä¢ person, car          ‚îÇ
    ‚îÇ ‚Ä¢ l_ear, r_ear           ‚îÇ  ‚îÇ ‚Ä¢ grass, water         ‚îÇ
    ‚îÇ ‚Ä¢ mouth, u_lip, l_lip    ‚îÇ  ‚îÇ ‚Ä¢ And 100+ categories  ‚îÇ
    ‚îÇ ‚Ä¢ hair, neck, cloth      ‚îÇ  ‚îÇ                        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                      ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            STEP 3: DISPLAY RESULTS                                   ‚îÇ
‚îÇ  ‚Ä¢ Show mode badge (üë§ Face Mode / üèûÔ∏è Landscape Mode)              ‚îÇ
‚îÇ  ‚Ä¢ Toast notification with detected type                            ‚îÇ
‚îÇ  ‚Ä¢ Enable hover selection with detected regions                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

================================================================================
                          CODE IMPLEMENTATION
================================================================================

1. NEW API FUNCTIONS (src/lib/api.ts)
--------------------------------------

A. detectImageType(imageBlob: Blob): Promise<'face' | 'landscape'>
   - Uses DETR object detection to find "person" objects
   - Calculates person area as percentage of image
   - Threshold: 25% person area = face/portrait
   - Returns: 'face' or 'landscape'

B. segmentLandscape(imageBlob: Blob): Promise<{ masks: [...] }>
   - Uses Mask2Former panoptic segmentation model
   - Model: facebook/mask2former-swin-base-coco-panoptic
   - Returns: Array of segmented objects with masks
   - Filters detections with score > 0.5

C. smartSegment(imageBlob: Blob): Promise<{ masks: [...], imageType: ... }>
   - Main orchestrator function
   - Calls detectImageType first
   - Routes to segmentImage (face) or segmentLandscape based on type
   - Returns: masks + detected image type

2. MODEL ENDPOINTS (src/lib/api.ts)
------------------------------------

const MODEL_ENDPOINTS = {
  'object-detection': 'facebook/detr-resnet-50',
  'face-parsing': 'jonathandinu/face-parsing',
  'face-detection': 'Xenova/detr-resnet-50',
  'panoptic-segmentation': 'facebook/mask2former-swin-base-coco-panoptic'
}

3. COMPONENT UPDATES (src/components/ExtractArt.tsx)
-----------------------------------------------------

A. New State Variable:
   const [imageType, setImageType] = useState<'face' | 'landscape' | null>(null);

B. Updated handleDetectRegions():
   - Calls smartSegment() instead of segmentImage()
   - Stores detected image type in state
   - Shows toast with emoji (üë§ or üèûÔ∏è) and model used

C. Updated handleReset():
   - Clears imageType state
   - Clears detectedRegions

D. New UI Badge:
   - Displays after detection
   - Blue badge for Face Mode (üë§)
   - Green badge for Landscape Mode (üèûÔ∏è)

E. Updated Help Section:
   - New entry explaining Smart Detection
   - Face mode: face parsing for features
   - Landscape mode: panoptic segmentation for objects

================================================================================
                          USAGE EXAMPLES
================================================================================

EXAMPLE 1: FACE/PORTRAIT IMAGE
-------------------------------

User uploads: Portrait photo with person's face
‚Üì
User clicks "Detect Regions"
‚Üì
Detection: Person detected, area = 45% of image
‚Üì
Result: üë§ FACE MODE
‚Üì
Model used: jonathandinu/face-parsing
‚Üì
Regions detected (14):
  - skin
  - nose
  - l_eye, r_eye
  - l_brow, r_brow
  - l_ear, r_ear
  - mouth, u_lip, l_lip
  - hair
  - neck
  - cloth
‚Üì
User can:
  - Hover to preview each facial feature
  - Click to extract individual features
  - Use prompt extraction: "eyes", "face without hair", etc.

EXAMPLE 2: LANDSCAPE IMAGE
---------------------------

User uploads: Nature scene with mountains and lake
‚Üì
User clicks "Detect Regions"
‚Üì
Detection: No person detected or person < 25% of image
‚Üì
Result: üèûÔ∏è LANDSCAPE MODE
‚Üì
Model used: facebook/mask2former-swin-base-coco-panoptic
‚Üì
Regions detected (varies, e.g., 8-20):
  - sky
  - mountain
  - tree
  - grass
  - water
  - rock
  - etc.
‚Üì
User can:
  - Hover to preview each object/region
  - Click to extract individual objects
  - Use prompt extraction: "sky", "all trees", etc.

EXAMPLE 3: GROUP PHOTO (Multiple People)
-----------------------------------------

User uploads: Group photo with 5 people
‚Üì
User clicks "Detect Regions"
‚Üì
Detection: People detected, but largest person = 18% of image
‚Üì
Result: üèûÔ∏è LANDSCAPE MODE
‚Üì
Model used: Panoptic segmentation (treats as scene with multiple objects)
‚Üì
Regions detected:
  - person (instance 1)
  - person (instance 2)
  - person (instance 3)
  - person (instance 4)
  - person (instance 5)
  - background elements
‚Üì
User can extract each person separately or together

EXAMPLE 4: CLOSE-UP PORTRAIT
-----------------------------

User uploads: Professional headshot
‚Üì
User clicks "Detect Regions"
‚Üì
Detection: Person detected, area = 85% of image
‚Üì
Result: üë§ FACE MODE
‚Üì
Model used: Face parsing (ideal for this scenario)
‚Üì
Regions detected: All 14 facial features with high precision
‚Üì
Perfect for extracting specific facial features

================================================================================
                          VISUAL UI CHANGES
================================================================================

1. MODE BADGE (appears after detection)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ [Reset] [Detect Regions] ‚îÇüë§ Face Mode‚îÇ ‚îÇ  ‚Üê Blue badge for face
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

   OR

   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ [Reset] [Detect Regions] ‚îÇüèûÔ∏è Landscape Mode‚îÇ ‚îÇ  ‚Üê Green badge
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

2. TOAST NOTIFICATION
   ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
   ‚ïë üë§ Face Image Detected                  ‚ïë
   ‚ïë Found 14 regions. Using face parsing    ‚ïë
   ‚ïë model.                                   ‚ïë
   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

   OR

   ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
   ‚ïë üèûÔ∏è Landscape Image Detected             ‚ïë
   ‚ïë Found 12 regions. Using panoptic         ‚ïë
   ‚ïë segmentation model.                      ‚ïë
   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

3. HELP PANEL (updated)
   ‚Ä¢ ü§ñ Smart Detection: Automatically detects image type (Face/Landscape)
     ‚Üí Face images: Uses face parsing for features (eyes, nose, hair, etc.)
     ‚Üí Landscape images: Uses panoptic segmentation for objects (sky, trees, buildings, etc.)

================================================================================
                          TECHNICAL DETAILS
================================================================================

AI MODELS USED:
---------------

1. DETR (Detection Transformer) - Object Detection
   - Model: facebook/detr-resnet-50
   - Purpose: Detect "person" objects to determine image type
   - Input: Image blob (binary)
   - Output: Array of detections with labels, scores, and bounding boxes
   - Use case: Image type classification

2. Face Parsing Model
   - Model: jonathandinu/face-parsing
   - Purpose: Pixel-perfect face segmentation
   - Input: Image blob
   - Output: 14 labeled masks (skin, eyes, nose, etc.)
   - Use case: Portrait/face images

3. Mask2Former - Panoptic Segmentation
   - Model: facebook/mask2former-swin-base-coco-panoptic
   - Purpose: General object and scene segmentation
   - Input: Image blob
   - Output: Variable number of object masks (COCO dataset categories)
   - Use case: Landscape, objects, scenes

DETECTION LOGIC:
----------------

Person Area Calculation:
  personArea = (box.xmax - box.xmin) √ó (box.ymax - box.ymin)

Threshold:
  if personArea > 0.25 (25%):
    imageType = 'face'
  else:
    imageType = 'landscape'

Why 25%?
  - Professional portraits typically have person filling 40-80% of frame
  - Group photos have individuals at 10-20% each
  - Landscape shots with people have persons at 5-15%
  - 25% is a good middle ground to distinguish close-up portraits

ERROR HANDLING:
---------------

1. No API Key:
   - detectImageType returns 'landscape' (default)
   - Manual tools still work

2. Detection API Fails:
   - Falls back to 'landscape' mode
   - Logs warning to console

3. Model Loading:
   - Both models auto-retry with exponential backoff
   - Shows "Model loading..." message
   - Waits 2-4 seconds between retries

4. Rate Limiting:
   - Client-side: 20 requests/minute
   - Auto-retry when limit exceeded
   - User sees "Rate limit exceeded" message

PERFORMANCE:
------------

Typical Detection Times:
  - Image type detection: 1-2 seconds
  - Face parsing: 2-4 seconds
  - Panoptic segmentation: 3-6 seconds
  - Total: 3-8 seconds from click to results

Memory Usage:
  - Image blobs stored temporarily
  - Masks cached as HTMLImageElement objects
  - Outlines pre-generated for hover performance

API Calls:
  - 1 call to detect image type
  - 1 call to segment (face or landscape model)
  - Total: 2 API calls per detection

================================================================================
                          TESTING GUIDE
================================================================================

TEST CASES:
-----------

‚úì TEST 1: Professional Headshot
  Expected: üë§ Face Mode
  Regions: 14 face parts
  Model: face-parsing

‚úì TEST 2: Nature Landscape
  Expected: üèûÔ∏è Landscape Mode
  Regions: 8-20 objects (sky, trees, grass, etc.)
  Model: Mask2Former

‚úì TEST 3: Group Photo
  Expected: üèûÔ∏è Landscape Mode (multiple people, each < 25%)
  Regions: Multiple person instances + background
  Model: Mask2Former

‚úì TEST 4: Full-Body Portrait
  Expected: üë§ Face Mode (person dominates frame)
  Regions: 14 face parts (if face visible)
  Model: face-parsing

‚úì TEST 5: Selfie/Close-up
  Expected: üë§ Face Mode (face fills > 25% of image)
  Regions: 14 face parts with high precision
  Model: face-parsing

‚úì TEST 6: Street Scene with People
  Expected: üèûÔ∏è Landscape Mode (people small in frame)
  Regions: People, buildings, road, sky, etc.
  Model: Mask2Former

‚úì TEST 7: Product Photo
  Expected: üèûÔ∏è Landscape Mode (no person)
  Regions: Object, background, table, etc.
  Model: Mask2Former

‚úì TEST 8: No API Key
  Expected: Defaults to üèûÔ∏è Landscape Mode
  Manual tools still functional

HOW TO TEST:
------------

1. Start dev server: npm run dev
2. Open http://localhost:3000
3. Upload test images (one at a time):
   - Portrait/headshot
   - Landscape photo
   - Group photo
   - Selfie
   - Street scene
   - Product image
4. Click "Detect Regions" for each
5. Verify:
   ‚úì Correct mode badge appears (üë§ or üèûÔ∏è)
   ‚úì Correct toast notification
   ‚úì Appropriate regions detected
   ‚úì Hover preview works
   ‚úì Click extraction works
6. Check browser console for detection logs:
   - "üîç Starting smart segmentation..."
   - "üì∏ Image type detected: FACE/LANDSCAPE"
   - "üë§ Using face parsing model..." OR "üèûÔ∏è Using panoptic segmentation model..."
   - "‚úÖ Smart segmentation complete: N regions found"

================================================================================
                          BENEFITS
================================================================================

1. AUTOMATIC - No user configuration needed
2. INTELLIGENT - Uses best model for each image type
3. VERSATILE - Works for faces AND landscapes/objects
4. TRANSPARENT - Clear visual feedback about which mode is active
5. EFFICIENT - Only 2 API calls (detection + segmentation)
6. ROBUST - Fallback logic if detection fails
7. USER-FRIENDLY - Emojis and color-coded badges
8. EXTENSIBLE - Easy to add more image types/models in future

================================================================================
                          FUTURE ENHANCEMENTS
================================================================================

POTENTIAL IMPROVEMENTS:
-----------------------

1. More Image Types:
   - Add 'animal' mode for pet photos
   - Add 'document' mode for text extraction
   - Add 'product' mode for e-commerce

2. Better Detection:
   - Use face detection API for higher accuracy
   - Multi-stage detection (face ‚Üí if not, landscape)
   - ML-based image classification

3. User Override:
   - Allow manual mode selection
   - "Detected wrong? Click to switch mode"

4. Smart Prompts:
   - Context-aware prompt suggestions
   - Face mode: "eyes", "nose", "hair"
   - Landscape mode: "sky", "trees", "buildings"

5. Performance:
   - Cache detection results
   - Parallel API calls
   - WebWorker for image processing

6. Advanced Features:
   - Instance segmentation (multiple instances of same object)
   - Depth-aware extraction
   - Style-aware segmentation

================================================================================
                          TROUBLESHOOTING
================================================================================

ISSUE: Always detects landscape, even for faces
SOLUTION:
  - Check if person is detected in object detection
  - Lower threshold from 25% to 20%
  - Ensure image quality is good (not too small/blurry)

ISSUE: Model loading timeout
SOLUTION:
  - Wait 30-60 seconds for model to load on first use
  - Retry detection
  - Check Hugging Face API status

ISSUE: Wrong regions detected
SOLUTION:
  - Face mode detects landscapes: Person might be too small in frame
  - Landscape mode on portrait: Try zooming in on person
  - Use manual lasso tool as fallback

ISSUE: No mode badge appears
SOLUTION:
  - Check if imageType state is set
  - Check console for errors
  - Verify smartSegment returns imageType

ISSUE: Panoptic segmentation finds too many regions
SOLUTION:
  - Increase confidence threshold (currently 0.5)
  - Filter by region size
  - Group similar regions

================================================================================
                          FILES MODIFIED
================================================================================

1. src/lib/api.ts
   - Added MODEL_ENDPOINTS.panoptic-segmentation
   - Added detectImageType() function
   - Added segmentLandscape() function
   - Added smartSegment() function (main orchestrator)

2. src/components/ExtractArt.tsx
   - Imported smartSegment from api
   - Added imageType state variable
   - Updated handleDetectRegions to use smartSegment
   - Updated handleReset to clear imageType
   - Added mode badge UI component
   - Updated help section with Smart Detection info

3. No changes needed:
   - KonvaCanvas.tsx (works with both modes)
   - Other UI components (compatible with new feature)

================================================================================
                          CONSOLE OUTPUT EXAMPLE
================================================================================

FACE IMAGE DETECTION:
---------------------
üîç Starting smart segmentation...
Detecting image type (face vs landscape)...
‚úì Detected FACE image (person area: 68.3%)
üì∏ Image type detected: FACE
üë§ Using face parsing model...
Calling face parsing API...
Face parsing response: [14 items]
Successfully parsed 14 face regions
‚úÖ Smart segmentation complete: 14 regions found

LANDSCAPE IMAGE DETECTION:
--------------------------
üîç Starting smart segmentation...
Detecting image type (face vs landscape)...
‚úì Detected LANDSCAPE image (no prominent person)
üì∏ Image type detected: LANDSCAPE
üèûÔ∏è Using panoptic segmentation model...
Calling panoptic segmentation API for landscape/objects...
Panoptic segmentation response: [18 items]
Successfully segmented 12 objects in landscape
‚úÖ Smart segmentation complete: 12 regions found

================================================================================
                          END OF DOCUMENTATION
================================================================================

Feature Status: ‚úÖ IMPLEMENTED AND TESTED
Development Server: http://localhost:3000 (running)
Last Updated: October 28, 2025

To test this feature:
1. Upload different types of images (portraits, landscapes, group photos)
2. Click "Detect Regions" button
3. Observe the mode badge and toast notification
4. Check browser console for detailed detection logs
5. Try extracting regions with hover + click

For questions or issues, check the main documentation:
C:\Users\Kunal\OneDrive\Desktop\October\SoltcraftAI\extract-art-feature\EXTRACT_ART_DEMO_DOCUMENTATION.txt
